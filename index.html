<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>作業記録アプリ（検品・積込モード）</title>
  <style>
    html {
      font-size: clamp(16px, 6vw, 40px);
    }
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      transition: background-color 0.3s;
      background-color: #e0f7fa;
    }
    h1 {
      text-align: center;
      margin: 1em 0 0.5em;
      color: #333;
      font-size: 1.5em;
    }
    .tab-container {
      display: flex;
      justify-content: center;
      background: #ddd;
      flex-wrap: wrap;
    }
    .tab {
      padding: 0.8em 2em;
      cursor: pointer;
      font-weight: bold;
      border-bottom: 3px solid transparent;
      user-select: none;
      font-size: 1em;

      -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
      -webkit-user-select: none;
      -ms-user-select: none;
      touch-action: manipulation;
    }

    .tab.active {
      border-bottom: 3px solid #2196F3;
      background: #fff;
    }
    .mode-container {
      padding: 1em;
    }
    .course-card {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.2em 1em;
      margin: 1em 0;
      background-color: white;
      border-radius: 10px;
      box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);
    }
    .course-name {
      font-size: 2em;
      font-weight: bold;
      line-height: 1.1;
      max-width: 65%;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }
    button.main-btn {
      font-size: 1.6em;
      padding: 0.8em 1em;
      width: 6em;
      height: 3.2em;
      border: none;
      border-radius: 40px;
      color: white;
      background-color: #1976d2;
      cursor: pointer;
      flex-shrink: 0;
      text-align: center;

      user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
      touch-action: manipulation;
      -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
      outline: none;
    }

    button.main-btn.disabled {
      background-color: #999 !important;
      cursor: default;
    }
    button.main-btn.dock-end:not(.disabled) {
      background-color: #f44336;
    }
    .dock-start    { background-color: #1976d2; }
    .dock-end      { background-color: #f44336; }
    .inspect-start { background-color: #388e3c; }
    .btn-sending   { background-color: #999999 !important; }
    .btn-done      { background-color: #000000 !important; }
    .hidden { display: none; }

    button.main-btn.btn-done {
      background-color: #000000 !important;
    }

  </style>
</head>
<body>


<div id="title-bar" style="
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 20px;
  margin-bottom: 20px;
  position: relative;
">
  <h1 style="
    font-size: 100px;
    font-weight: bold;
    color: #1976d2;
    text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.2);
    margin: 0;
    display: flex;
    align-items: center; /* ← これが中央揃えのカギ */
  ">
  <img src="data:image/png;base64,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" 
       width="128" height="128" 
       style="margin-right: 20px;" />
    ハコベズ
  </h1>
  <!-- RボタンはJSで追加される -->
</div>


  <div class="tab-container">
    <div class="tab active" data-mode="workload">📦 積込モード</div>
    <div class="tab" data-mode="inspection">📝 検品モード</div>
  </div>

  <!-- Workload Mode -->
  <div id="workload" class="mode-container">
    <div class="course-card" data-course="南大阪"><div class="course-name">南大阪</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="広島"><div class="course-name">広島</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="岡山"><div class="course-name">岡山</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="宇和島"><div class="course-name">宇和島</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="島根"><div class="course-name">島根</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="東大阪"><div class="course-name">東大阪</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="豊岡"><div class="course-name">豊岡</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="豊中"><div class="course-name">豊中</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="松山"><div class="course-name">松山</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="東予"><div class="course-name">東予</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="高知"><div class="course-name">高知</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="坂出"><div class="course-name">坂出</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="徳島"><div class="course-name">徳島</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="尾道"><div class="course-name">尾道</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="和歌山"><div class="course-name">和歌山</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="金沢"><div class="course-name">金沢</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="富山"><div class="course-name">富山</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="福井"><div class="course-name">福井</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="神戸"><div class="course-name">神戸</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="西神戸"><div class="course-name">西神戸</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="姫路"><div class="course-name">姫路</div><button class="main-btn">接岸</button></div>
    <div class="course-card" data-course="鶴見"><div class="course-name">鶴見</div><button class="main-btn">接岸</button></div>
  </div>

  <!-- Inspection Mode -->
  <div id="inspection" class="mode-container hidden">
    <div class="course-card" data-course="南大阪"><div class="course-name">南大阪</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="広島"><div class="course-name">広島</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="岡山"><div class="course-name">岡山</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="宇和島"><div class="course-name">宇和島</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="島根"><div class="course-name">島根</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="東大阪"><div class="course-name">東大阪</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="豊岡"><div class="course-name">豊岡</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="豊中"><div class="course-name">豊中</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="松山"><div class="course-name">松山</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="東予"><div class="course-name">東予</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="高知"><div class="course-name">高知</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="坂出"><div class="course-name">坂出</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="徳島"><div class="course-name">徳島</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="尾道"><div class="course-name">尾道</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="和歌山"><div class="course-name">和歌山</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="金沢"><div class="course-name">金沢</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="富山"><div class="course-name">富山</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="福井"><div class="course-name">福井</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="神戸"><div class="course-name">神戸</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="西神戸"><div class="course-name">西神戸</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="姫路"><div class="course-name">姫路</div><button class="main-btn">検品終了</button></div>
    <div class="course-card" data-course="鶴見"><div class="course-name">鶴見</div><button class="main-btn">検品終了</button></div>
  </div>

<!-- JavaScript -->
<script>
function initializeApp() {
  const STORAGE_KEY = 'workloadInspectionAppState';

  const records = {
    workload: {},
    inspection: {}
  };

  const allCourses = [
    "南大阪","広島","岡山","宇和島","島根","東大阪","豊岡","豊中",
    "松山","東予","高知","坂出","徳島",
    "尾道","和歌山","金沢","富山","福井","神戸","西神戸","姫路","鶴見"
  ];

  allCourses.forEach(course => {
    records.workload[course] = [];
    records.inspection[course] = [];
  });

  function saveStateToLocalStorage() {
    const state = {};
    document.querySelectorAll('.course-card').forEach(card => {
      const mode = card.closest('#workload') ? 'workload' : 'inspection';
      const course = card.dataset.course;
      const button = card.querySelector('.main-btn');
      const key = mode + '_' + course;

      // 送信中は保存しない（btn-sending クラスが含まれていればスキップ）
      if (button.className.includes('btn-sending')) return;

      state[key] = {
        text: button.textContent,
        className: button.className,
        disabled: button.disabled,
        stateValue: button.dataset.state || "0"
      };
    });
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  function loadStateFromLocalStorage() {
    const state = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
    document.querySelectorAll('.course-card').forEach(card => {
      const mode = card.closest('#workload') ? 'workload' : 'inspection';
      const course = card.dataset.course;
      const button = card.querySelector('.main-btn');
      const key = mode + '_' + course;

      if (state[key]) {
        button.textContent = state[key].text || (mode === 'workload' ? '接岸' : '検品終了');
        button.className = state[key].className || 'main-btn';
        button.disabled = !!state[key].disabled;
        button.dataset.state = state[key].stateValue || "0";
      } else {
        button.textContent = mode === 'workload' ? '接岸' : '検品終了';
        button.className = 'main-btn';
        button.disabled = false;
        button.dataset.state = "0";
      }
    });
  }

  function resetAppState() {
    localStorage.removeItem(STORAGE_KEY);

    document.querySelectorAll('.course-card').forEach(card => {
      const button = card.querySelector('.main-btn');
      const isInspection = card.closest('#inspection') !== null;
      button.textContent = isInspection ? '検品終了' : '接岸';
      button.className = 'main-btn';
      button.disabled = false;
      button.dataset.state = "0";
    });

    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.mode-container').forEach(mc => mc.classList.add('hidden'));
    document.querySelector('.tab[data-mode="workload"]').classList.add('active');
    document.getElementById('workload').classList.remove('hidden');
    document.body.style.backgroundColor = '#e0f7fa';

    alert('状態をリセットしました');
  }

  function createResetButton() {
    if (document.getElementById('reset-btn')) return;

    const btn = document.createElement('div');
    btn.id = 'reset-btn';
    btn.textContent = 'R';

    Object.assign(btn.style, {
      display: 'inline-flex',
      alignItems: 'center',
      justifyContent: 'center',
      width: '100px',
      height: '100px',
      backgroundColor: '#03a9f4',
      color: 'white',
      fontSize: '36px',
      fontWeight: 'bold',
      borderRadius: '8px',
      marginLeft: '20px',
      cursor: 'pointer',
      userSelect: 'none',
      flexShrink: '0'
    });

    btn.title = '長押しでリセット';
    setupLongPress(btn, resetAppState, 1000);

    const titleBar = document.getElementById('title-bar');
    if (titleBar) {
      titleBar.appendChild(btn);
    } else {
      document.body.appendChild(btn);
    }
  }

  function getJSTISOString() {
    const now = new Date();
    const jstOffset = 9 * 60 * 60 * 1000;
    const jst = new Date(now.getTime() + jstOffset);
    return jst.toISOString().replace('Z', '+09:00');
  }

  function setButtonState(button, text, className, disabled = false, stateValue = "0") {
    button.textContent = text;
    button.className = 'main-btn ' + className;
    button.disabled = disabled;
    if (disabled) button.classList.add('disabled');
    button.dataset.state = stateValue;

    // 「送信中」は保存しない
    if (!className.includes('btn-sending')) {
      saveStateToLocalStorage();
    }
  }

  async function uploadToDrive(recordList, button) {
    setButtonState(button, '送信中', 'btn-sending', true, button.dataset.state);
    await new Promise((resolve, reject) => {
      google.script.run
        .withSuccessHandler((result) => {
          if (result && result.status === 'success') {
            setButtonState(button, '終了', 'btn-done', true, "2");
            resolve();
          } else {
            alert('送信エラー: ' + (result.message || '不明なエラー'));
            location.reload();
          }
        })
        .withFailureHandler(err => {
          alert('送信エラー: ' + (err && err.message ? err.message : '不明な例外'));
          location.reload();
        })
        .saveRecord(recordList);
    });
  }

  function setupLongPress(el, callback, duration = 600) {
    let timer;
    const start = () => {
      if (el.disabled) return;
      timer = setTimeout(callback, duration);
    };
    const cancel = () => clearTimeout(timer);
    el.addEventListener('mousedown', start);
    el.addEventListener('touchstart', start);
    el.addEventListener('mouseup', cancel);
    el.addEventListener('mouseleave', cancel);
    el.addEventListener('touchend', cancel);
    el.addEventListener('touchcancel', cancel);
  }

  function showLeaveAlert(e) {
    e.preventDefault();
    e.returnValue = '';
  }

  window.addEventListener('beforeunload', showLeaveAlert);

  // タブ切り替え
  document.querySelectorAll('.tab').forEach(tab => {
    setupLongPress(tab, () => {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      document.querySelectorAll('.mode-container').forEach(mc => mc.classList.add('hidden'));
      document.getElementById(tab.dataset.mode).classList.remove('hidden');
      document.body.style.backgroundColor = (tab.dataset.mode === 'inspection') ? '#ffd6d6' : '#e0f7fa';
    });
  });

  // ローカルストレージから状態を復元
  loadStateFromLocalStorage();

  // ボタンのイベント登録
  document.querySelectorAll('.course-card').forEach(card => {
    const course = card.dataset.course;
    const button = card.querySelector('.main-btn');
    const isWorkload = card.closest('#workload') !== null;
    const isInspection = card.closest('#inspection') !== null;

    if (isWorkload) {
      setupLongPress(button, async () => {
        if (button.disabled) return;
        let state = Number(button.dataset.state || "0");
        const now = getJSTISOString();
        const rec = records.workload[course];

        if (state === 0) {
          rec.push({ mode: '積込', course, action: '接岸', timestamp: now });
          await uploadToDrive([rec[0]], button);
          setButtonState(button, '離岸', 'dock-end', false, "1");
          state = 1;
        } else if (state === 1) {
          rec.push({ mode: '積込', course, action: '離岸', timestamp: now });
          await uploadToDrive([rec[1]], button);
          setButtonState(button, '終了', 'btn-done', true, "2");
          state = 2;
        }

        button.dataset.state = state.toString();
        saveStateToLocalStorage();
      });
    } else if (isInspection) {
      setupLongPress(button, async () => {
        if (button.disabled) return;
        const now = getJSTISOString();
        const rec = records.inspection[course];
        rec.push({ mode: '検品', course, action: '検品終了', timestamp: now });
        await uploadToDrive(rec, button);
      });
    }
  });

  createResetButton();

  // 初期表示は積込モード
  document.querySelector('.tab[data-mode="workload"]').classList.add('active');
  document.getElementById('workload').classList.remove('hidden');
}

document.addEventListener('DOMContentLoaded', () => {
  initializeApp();
});
</script>




</body>
</html>
