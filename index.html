function doGet() {
  return HtmlService.createHtmlOutputFromFile('index');
}

function saveRecord(records) {
  try {
    if (!records || records.length === 0) {
      return { status: 'error', message: 'データが空です' };
    }

    const folder = DriveApp.getFoldersByName('作業記録').hasNext()
      ? DriveApp.getFoldersByName('作業記録').next()
      : DriveApp.createFolder('作業記録');

    if (records.length === 1) {
      // 検品モード用（常に1レコード）
      const record = records[0];
      const timePart = new Date(record.timestamp).toISOString().replace(/[:.]/g, '-');
      const filename = `${timePart}_${record.course}_${record.mode}_end.json`;

      const blob = Utilities.newBlob(JSON.stringify(record, null, 2), 'application/json', filename);
      folder.createFile(blob);
    } else {
      // 積込モード：開始・終了の2レコード
      records.forEach(record => {
        const timePart = new Date(record.timestamp).toISOString().replace(/[:.]/g, '-');
        const suffix = record.action === '開始' ? '_start' : '_end';
        const filename = `${timePart}_${record.course}_${record.mode}${suffix}.json`;

        const blob = Utilities.newBlob(JSON.stringify(record, null, 2), 'application/json', filename);
        folder.createFile(blob);
      });
    }

    return { status: 'success' };
  } catch (e) {
    return { status: 'error', message: e.toString() };
  }
}
